{% extends "base.html" %} {% block title %}Test CSV to Excel Conversion{%
endblock %} {% block content %}
<div class="container mx-auto px-4 py-8">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-900 mb-8">
      Test CSV to Excel Conversion
    </h1>

    <div class="bg-white shadow-lg rounded-lg p-6 mb-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Conversion Test</h2>
      <p class="text-gray-600 mb-4">
        This page tests the CSV to Excel conversion functionality using the
        provided CSV file.
      </p>

      <div class="space-y-4">
        <button
          id="testConversionBtn"
          class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
        >
          Test CSV to Excel Conversion
        </button>

        <div id="result" class="mt-4"></div>
      </div>
    </div>

    <div class="bg-white shadow-lg rounded-lg p-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Download Test</h2>
      <p class="text-gray-600 mb-4">
        Download the converted Excel file to verify it opens correctly in Excel.
      </p>

      <div id="downloadSection" class="space-y-4" style="display: none">
        <a
          id="downloadLink"
          href="#"
          class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded inline-block"
        >
          Download Excel File
        </a>
      </div>
    </div>
  </div>
</div>

<script>
  document
    .getElementById("testConversionBtn")
    .addEventListener("click", async function () {
      const resultDiv = document.getElementById("result");
      const downloadSection = document.getElementById("downloadSection");
      const downloadLink = document.getElementById("downloadLink");

      resultDiv.innerHTML =
        '<p class="text-blue-600">Testing conversion...</p>';

      try {
        const response = await fetch("/api/user/test-csv-conversion");
        const data = await response.json();

        if (data.success) {
          resultDiv.innerHTML = `
                <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
                    <p class="font-bold">✅ Conversion Successful!</p>
                    <p>Excel file: ${data.excel_file}</p>
                    <p>CSV rows: ${data.csv_rows}</p>
                    <p>CSV columns: ${data.csv_columns.join(", ")}</p>
                    <p>File size: ${data.excel_file_size} bytes</p>
                </div>
            `;

          // Show download section
          downloadSection.style.display = "block";
          downloadLink.href = `/api/user/download-excel/${data.excel_file
            .split("\\")
            .pop()}`;
        } else {
          resultDiv.innerHTML = `
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                    <p class="font-bold">❌ Conversion Failed!</p>
                    <p>${data.detail || "Unknown error"}</p>
                </div>
            `;
        }
      } catch (error) {
        resultDiv.innerHTML = `
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                <p class="font-bold">❌ Error!</p>
                <p>${error.message}</p>
            </div>
        `;
      }
    });
</script>
{% endblock %}
